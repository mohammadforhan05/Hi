<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡¶´‡¶∞‡ßç‡¶Æ ‡¶¨‡¶ø‡¶≤‡ßç‡¶°‡¶æ‡¶∞ - Firebase Edition</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        /* Loading Spinner */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            display: none;
        }

        .loading-overlay.active {
            display: flex;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            color: white;
            margin-left: 20px;
            font-size: 18px;
        }

        /* App Header */
        .app-header {
            background: white;
            padding: 20px 30px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .app-header h1 {
            color: #667eea;
            font-size: 28px;
        }

        .header-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        /* Buttons */
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .btn-primary { background: #667eea; color: white; }
        .btn-success { background: #48bb78; color: white; }
        .btn-danger { background: #f56565; color: white; }
        .btn-warning { background: #ed8936; color: white; }
        .btn-secondary { background: #718096; color: white; }
        .btn-info { background: #4299e1; color: white; }

        .btn-sm {
            padding: 6px 12px;
            font-size: 12px;
        }

        /* Card */
        .card {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        /* Pages */
        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        /* Login Page */
        .login-container {
            max-width: 400px;
            margin: 100px auto;
        }

        .login-card {
            background: white;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
            text-align: center;
        }

        .login-card h2 {
            color: #2d3748;
            margin-bottom: 10px;
        }

        .login-card p {
            color: #718096;
            margin-bottom: 30px;
        }

        /* Form Elements */
        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #2d3748;
            font-weight: 600;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 1px solid #cbd5e0;
            border-radius: 6px;
            font-size: 14px;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .stat-card h3 {
            font-size: 14px;
            margin-bottom: 10px;
            opacity: 0.9;
        }

        .stat-card .number {
            font-size: 36px;
            font-weight: bold;
        }

        /* Forms List */
        .forms-grid {
            display: grid;
            gap: 20px;
        }

        .form-item {
            background: #f7fafc;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s;
        }

        .form-item:hover {
            border-color: #667eea;
            box-shadow: 0 4px 8px rgba(102, 126, 234, 0.2);
        }

        .form-item-header h3 {
            color: #2d3748;
            margin-bottom: 5px;
        }

        .form-item-header p {
            color: #718096;
            font-size: 14px;
        }

        .form-item-meta {
            color: #718096;
            font-size: 12px;
            margin: 10px 0;
        }

        .form-item-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 15px;
        }

        /* Question Builder */
        .questions-list {
            margin: 20px 0;
        }

        .question-item {
            background: #f7fafc;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            transition: all 0.3s;
        }

        .question-item:hover {
            border-color: #667eea;
        }

        .question-header {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .question-header input {
            flex: 1;
        }

        .question-header select {
            width: auto;
            min-width: 200px;
        }

        .question-image-section {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }

        .image-preview-box {
            margin-top: 10px;
        }

        .image-preview-box img {
            max-width: 100%;
            max-height: 300px;
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .options-list {
            margin: 15px 0;
        }

        .option-row {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            align-items: center;
        }

        .option-row input {
            flex: 1;
            padding: 10px;
            border: 1px solid #cbd5e0;
            border-radius: 6px;
        }

        .question-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #e2e8f0;
        }

        .add-question-btn {
            width: 100%;
            padding: 15px;
            background: #667eea;
            color: white;
            border: 2px dashed #667eea;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .add-question-btn:hover {
            background: #5568d3;
            transform: translateY(-2px);
        }

        /* Form Fill View */
        .form-fill-wrapper {
            max-width: 800px;
            margin: 0 auto;
        }

        .form-header-section {
            background: white;
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 20px;
            text-align: center;
        }

        .form-header-section img {
            max-width: 100%;
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .form-header-section h1 {
            color: #2d3748;
            margin-bottom: 10px;
        }

        .form-header-section p {
            color: #718096;
        }

        .fill-question-item {
            background: white;
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .fill-question-item .question-label {
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 15px;
            font-size: 16px;
        }

        .fill-question-item .required-mark {
            color: #f56565;
            margin-left: 5px;
        }

        .fill-question-item img {
            max-width: 100%;
            border-radius: 8px;
            margin: 10px 0;
        }

        .fill-question-item .image-desc {
            color: #718096;
            font-size: 14px;
            font-style: italic;
            margin-bottom: 15px;
        }

        .fill-question-item input[type="text"],
        .fill-question-item textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #cbd5e0;
            border-radius: 6px;
            font-size: 14px;
        }

        .fill-question-item textarea {
            min-height: 100px;
            resize: vertical;
        }

        .radio-group,
        .checkbox-group {
            display: grid;
            gap: 10px;
        }

        .choice-option {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px;
            background: #f7fafc;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .choice-option:hover {
            border-color: #667eea;
            background: #edf2f7;
        }

        .choice-option input[type="radio"],
        .choice-option input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        /* Success Message */
        .success-alert {
            background: #48bb78;
            color: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            margin-bottom: 20px;
            font-size: 18px;
            font-weight: 600;
            display: none;
        }

        .success-alert.show {
            display: block;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal-box {
            background: white;
            padding: 30px;
            border-radius: 12px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-header h3 {
            color: #2d3748;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 28px;
            cursor: pointer;
            color: #718096;
            line-height: 1;
        }

        .modal-close:hover {
            color: #2d3748;
        }

        .share-link-container {
            background: #f7fafc;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }

        .share-link-container input {
            width: 100%;
            padding: 10px;
            border: 1px solid #cbd5e0;
            border-radius: 6px;
            margin-bottom: 10px;
        }

        /* File Upload */
        .file-upload-label {
            display: inline-block;
            padding: 10px 20px;
            background: #667eea;
            color: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .file-upload-label:hover {
            background: #5568d3;
        }

        input[type="file"] {
            display: none;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #718096;
        }

        .empty-state-icon {
            font-size: 64px;
            margin-bottom: 20px;
        }

        /* Response View */
        .response-item {
            background: white;
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .response-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e2e8f0;
        }

        .response-content {
            display: grid;
            gap: 15px;
        }

        .response-qa {
            background: #f7fafc;
            padding: 15px;
            border-radius: 8px;
        }

        .response-qa .q {
            color: #667eea;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .response-qa .a {
            color: #2d3748;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .app-header {
                flex-direction: column;
                text-align: center;
            }

            .header-buttons {
                width: 100%;
                justify-content: center;
            }

            .form-item-actions {
                flex-direction: column;
            }

            .form-item-actions .btn {
                width: 100%;
            }

            .question-header {
                flex-direction: column;
            }

            .question-header select {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="spinner"></div>
        <div class="loading-text">‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</div>
    </div>

    <div class="container">
        <!-- Login Page -->
        <div id="loginPage" class="page active">
            <div class="login-container">
                <div class="login-card">
                    <div style="font-size: 48px; margin-bottom: 20px;">üîê</div>
                    <h2>‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶≤‡¶ó‡¶á‡¶®</h2>
                    <p>‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤‡ßá ‡¶™‡ßç‡¶∞‡¶¨‡ßá‡¶∂ ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶¶‡¶ø‡¶®</p>
                    <div class="form-group">
                        <input type="password" id="loginPassword" placeholder="‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®" onkeypress="if(event.key==='Enter') attemptLogin()">
                    </div>
                    <button class="btn btn-primary" style="width: 100%;" onclick="attemptLogin()">‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                    <p id="defaultPasswordHint" style="margin-top: 20px; font-size: 12px;">‡¶™‡ßç‡¶∞‡¶•‡¶Æ‡¶¨‡¶æ‡¶∞ ‡¶≤‡¶ó‡¶á‡¶®? ‡¶°‡¶ø‡¶´‡¶≤‡ßç‡¶ü ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°: <strong>admin123</strong><br><span style="color: #f56565;">‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶™‡¶∞ ‡¶Ö‡¶¨‡¶∂‡ßç‡¶Ø‡¶á ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®!</span></p>
                </div>
            </div>
        </div>

        <!-- Admin Dashboard -->
        <div id="adminPage" class="page">
            <div class="app-header">
                <h1>üìù ‡¶´‡¶∞‡ßç‡¶Æ ‡¶¨‡¶ø‡¶≤‡ßç‡¶°‡¶æ‡¶∞ - ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤</h1>
                <div class="header-buttons">
                    <button class="btn btn-success" onclick="createNewForm()">‚ûï ‡¶®‡¶§‡ßÅ‡¶® ‡¶´‡¶∞‡ßç‡¶Æ ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                    <button class="btn btn-warning" onclick="openChangePasswordModal()">üîê ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶®</button>
                    <button class="btn btn-danger" onclick="logoutAdmin()">üö™ ‡¶≤‡¶ó ‡¶Ü‡¶â‡¶ü</button>
                </div>
            </div>

            <div class="card">
                <div class="stats-grid">
                    <div class="stat-card">
                        <h3>‡¶Æ‡ßã‡¶ü ‡¶´‡¶∞‡ßç‡¶Æ</h3>
                        <div class="number" id="statTotalForms">0</div>
                    </div>
                    <div class="stat-card">
                        <h3>‡¶Æ‡ßã‡¶ü ‡¶∞‡ßá‡¶∏‡¶™‡¶®‡ßç‡¶∏</h3>
                        <div class="number" id="statTotalResponses">0</div>
                    </div>
                    <div class="stat-card">
                        <h3>‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶∞‡ßá‡¶∏‡¶™‡¶®‡ßç‡¶∏</h3>
                        <div class="number" id="statTodayResponses">0</div>
                    </div>
                </div>

                <h2 style="color: #2d3748; margin-bottom: 20px;">‡¶∏‡¶ï‡¶≤ ‡¶´‡¶∞‡ßç‡¶Æ</h2>
                <div id="formsListContainer"></div>
            </div>
        </div>

        <!-- Form Builder Page -->
        <div id="builderPage" class="page">
            <div class="app-header">
                <h1>üìù ‡¶´‡¶∞‡ßç‡¶Æ ‡¶§‡ßà‡¶∞‡¶ø/‡¶∏‡¶Æ‡ßç‡¶™‡¶æ‡¶¶‡¶®‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®</h1>
                <div class="header-buttons">
                    <button class="btn btn-success" onclick="saveCurrentForm()">üíæ ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                    <button class="btn btn-secondary" onclick="backToAdmin()">‚ùå ‡¶¨‡¶æ‡¶§‡¶ø‡¶≤</button>
                </div>
            </div>

            <div class="card">
                <div class="form-group">
                    <label>‡¶´‡¶∞‡ßç‡¶Æ‡ßá‡¶∞ ‡¶∂‡¶ø‡¶∞‡ßã‡¶®‡¶æ‡¶Æ <span style="color: #f56565;">*</span></label>
                    <input type="text" id="builderFormTitle" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶´‡¶∞‡ßç‡¶Æ‡ßá‡¶∞ ‡¶∂‡¶ø‡¶∞‡ßã‡¶®‡¶æ‡¶Æ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®">
                </div>

                <div class="form-group">
                    <label>‡¶´‡¶∞‡ßç‡¶Æ‡ßá‡¶∞ ‡¶¨‡¶ø‡¶¨‡¶∞‡¶£ (‡¶ê‡¶ö‡ßç‡¶õ‡¶ø‡¶ï)</label>
                    <textarea id="builderFormDesc" rows="3" placeholder="‡¶´‡¶∞‡ßç‡¶Æ ‡¶∏‡¶Æ‡ßç‡¶™‡¶∞‡ßç‡¶ï‡ßá ‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®"></textarea>
                </div>

                <div class="form-group">
                    <label>‡¶´‡¶∞‡ßç‡¶Æ‡ßá‡¶∞ ‡¶π‡ßá‡¶°‡¶æ‡¶∞ ‡¶õ‡¶¨‡¶ø (‡¶ê‡¶ö‡ßç‡¶õ‡¶ø‡¶ï)</label>
                    <label for="builderHeaderImage" class="file-upload-label">üì∑ ‡¶õ‡¶¨‡¶ø ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®</label>
                    <input type="file" id="builderHeaderImage" accept="image/*" onchange="handleHeaderImageUpload(event)">
                    <div id="headerImagePreview"></div>
                </div>
            </div>

            <div class="card">
                <h3 style="color: #2d3748; margin-bottom: 20px;">‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶®‡¶∏‡¶Æ‡ßÇ‡¶π</h3>
                <div id="questionsList"></div>
                <button class="add-question-btn" onclick="addNewQuestion()">
                    <span style="font-size: 24px;">‚ûï</span>
                    <span>‡¶®‡¶§‡ßÅ‡¶® ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</span>
                </button>
            </div>
        </div>

        <!-- Form Fill Page (Public) -->
        <div id="fillPage" class="page">
            <div class="form-fill-wrapper">
                <div class="success-alert" id="submitSuccess">
                    ‚úÖ ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶â‡¶§‡ßç‡¶§‡¶∞ ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶ú‡¶Æ‡¶æ ‡¶¶‡ßá‡¶ì‡¶Ø‡¶º‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá! ‡¶ß‡¶®‡ßç‡¶Ø‡¶¨‡¶æ‡¶¶‡•§
                </div>
                <div id="fillFormContainer"></div>
            </div>
        </div>

        <!-- Responses Page -->
        <div id="responsesPage" class="page">
            <div class="app-header">
                <h1 id="responsesPageTitle">‡¶∞‡ßá‡¶∏‡¶™‡¶®‡ßç‡¶∏ ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®</h1>
                <div class="header-buttons">
                    <button class="btn btn-primary" onclick="exportCurrentResponses()">üì• CSV ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶°</button>
                    <button class="btn btn-secondary" onclick="backToAdmin()">üîô ‡¶´‡¶ø‡¶∞‡ßá ‡¶Ø‡¶æ‡¶®</button>
                </div>
            </div>

            <div class="card">
                <div id="responsesListContainer"></div>
            </div>
        </div>
    </div>

    <!-- Share Modal -->
    <div id="shareModal" class="modal-overlay">
        <div class="modal-box">
            <div class="modal-header">
                <h3>üì§ ‡¶´‡¶∞‡ßç‡¶Æ ‡¶∂‡ßá‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®</h3>
                <button class="modal-close" onclick="closeShareModal()">&times;</button>
            </div>
            <p style="color: #718096; margin-bottom: 15px;">‡¶®‡¶ø‡¶ö‡ßá‡¶∞ ‡¶≤‡¶ø‡¶Ç‡¶ï‡¶ü‡¶ø ‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡ßá WhatsApp, Messenger, ‡¶¨‡¶æ ‡¶Ø‡ßá‡¶ï‡ßã‡¶®‡ßã ‡¶ú‡¶æ‡¶Ø‡¶º‡¶ó‡¶æ‡¶Ø‡¶º ‡¶∂‡ßá‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®:</p>
            <div class="share-link-container">
                <label style="font-weight: 600; color: #2d3748; margin-bottom: 8px; display: block;">‡¶´‡¶∞‡ßç‡¶Æ ‡¶≤‡¶ø‡¶Ç‡¶ï:</label>
                <input type="text" id="shareLinkInput" readonly style="font-size: 13px;">
                <button class="btn btn-primary" style="width: 100%;" onclick="copyShareLink()">üìã ‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®</button>
            </div>
            <p id="copySuccessMsg" style="color: #48bb78; margin-top: 10px; display: none; text-align: center; font-weight: 600;">‚úÖ ‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶ï‡¶™‡¶ø ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá! ‡¶è‡¶ñ‡¶® WhatsApp ‡¶¨‡¶æ Messenger ‡¶è ‡¶™‡ßá‡¶∏‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</p>
            
            <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #e2e8f0;">
                <p style="color: #718096; font-size: 14px; margin-bottom: 10px;">üí° <strong>‡¶ï‡¶ø‡¶≠‡¶æ‡¶¨‡ßá ‡¶∂‡ßá‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶¨‡ßá‡¶®:</strong></p>
                <ol style="color: #718096; font-size: 14px; padding-left: 20px;">
                    <li>‡¶â‡¶™‡¶∞‡ßá‡¶∞ "‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®" ‡¶¨‡¶æ‡¶ü‡¶®‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®</li>
                    <li>WhatsApp, Messenger ‡¶¨‡¶æ Facebook ‡¶ñ‡ßÅ‡¶≤‡ßÅ‡¶®</li>
                    <li>‡¶Ø‡¶æ‡¶ï‡ßá ‡¶™‡¶æ‡¶†‡¶æ‡¶§‡ßá ‡¶ö‡¶æ‡¶® ‡¶§‡¶æ‡¶∞ ‡¶ö‡ßç‡¶Ø‡¶æ‡¶ü‡ßá ‡¶≤‡¶ø‡¶Ç‡¶ï‡¶ü‡¶ø ‡¶™‡ßá‡¶∏‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</li>
                    <li>‡¶≤‡¶ø‡¶Ç‡¶ï‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡¶≤‡ßá‡¶á ‡¶´‡¶∞‡ßç‡¶Æ ‡¶ñ‡ßÅ‡¶≤‡ßá ‡¶Ø‡¶æ‡¶¨‡ßá</li>
                </ol>
            </div>
        </div>
    </div>

    <!-- Change Password Modal -->
    <div id="changePasswordModal" class="modal-overlay">
        <div class="modal-box">
            <div class="modal-header">
                <h3>üîê ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</h3>
                <button class="modal-close" onclick="closeChangePasswordModal()">&times;</button>
            </div>
            
            <div class="form-group">
                <label>‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° <span style="color: #f56565;">*</span></label>
                <input type="password" id="currentPassword" placeholder="‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®">
            </div>

            <div class="form-group">
                <label>‡¶®‡¶§‡ßÅ‡¶® ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° <span style="color: #f56565;">*</span></label>
                <input type="password" id="newPassword" placeholder="‡¶®‡¶§‡ßÅ‡¶® ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶® (‡¶ï‡¶Æ‡¶™‡¶ï‡ßç‡¶∑‡ßá ‡ß¨ ‡¶Ö‡¶ï‡ßç‡¶∑‡¶∞)">
            </div>

            <div class="form-group">
                <label>‡¶®‡¶§‡ßÅ‡¶® ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶ï‡¶∞‡ßÅ‡¶® <span style="color: #f56565;">*</span></label>
                <input type="password" id="confirmPassword" placeholder="‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶®‡¶§‡ßÅ‡¶® ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®">
            </div>

            <div id="passwordChangeError" style="color: #f56565; margin-bottom: 15px; display: none; padding: 10px; background: #fff5f5; border-radius: 6px;"></div>
            <div id="passwordChangeSuccess" style="color: #48bb78; margin-bottom: 15px; display: none; padding: 10px; background: #f0fff4; border-radius: 6px;"></div>

            <div style="display: flex; gap: 10px;">
                <button class="btn btn-success" style="flex: 1;" onclick="changeAdminPassword()">‚úÖ ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                <button class="btn btn-secondary" onclick="closeChangePasswordModal()">‡¶¨‡¶æ‡¶§‡¶ø‡¶≤</button>
            </div>

            <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #e2e8f0;">
                <p style="color: #718096; font-size: 14px; margin-bottom: 10px;">üí° <strong>‡¶®‡¶ø‡¶∞‡¶æ‡¶™‡¶§‡ßç‡¶§‡¶æ ‡¶ü‡¶ø‡¶™‡¶∏:</strong></p>
                <ul style="color: #718096; font-size: 13px; padding-left: 20px;">
                    <li>‡¶ï‡¶Æ‡¶™‡¶ï‡ßç‡¶∑‡ßá ‡ß¨ ‡¶Ö‡¶ï‡ßç‡¶∑‡¶∞‡ßá‡¶∞ ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®</li>
                    <li>‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ ‡¶è‡¶¨‡¶Ç ‡¶¨‡¶ø‡¶∂‡ßá‡¶∑ ‡¶ö‡¶ø‡¶π‡ßç‡¶® ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</li>
                    <li>‡¶∏‡¶π‡¶ú ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° (‡¶Ø‡ßá‡¶Æ‡¶®: 123456) ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶¨‡ßá‡¶® ‡¶®‡¶æ</li>
                    <li>‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶®‡¶ø‡¶Ø‡¶º‡¶Æ‡¶ø‡¶§ ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-storage-compat.js"></script>

    <script>
        // ==================== FIREBASE CONFIGURATION ====================
        // ‚úÖ Firebase Configuration Ready!
        const firebaseConfig = {
            apiKey: "AIzaSyA43tJAceOh_nIzKeUZhkhH97ROus7ScnA",
            authDomain: "myformbuilder-201aa.firebaseapp.com",
            projectId: "myformbuilder-201aa",
            storageBucket: "myformbuilder-201aa.firebasestorage.app",
            messagingSenderId: "895746791294",
            appId: "1:895746791294:web:d41835deed251d1e90c52f",
            measurementId: "G-D41ENCQREW"
        };

        // Initialize Firebase
        let app, auth, db, storage;
        let currentUser = null;

        try {
            app = firebase.initializeApp(firebaseConfig);
            auth = firebase.auth();
            db = firebase.firestore();
            storage = firebase.storage();
            console.log('‚úÖ Firebase initialized successfully');
        } catch (error) {
            console.error('‚ùå Firebase initialization error:', error);
            alert('Firebase ‡¶∏‡ßá‡¶ü‡¶Ü‡¶™ ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ! ‡¶¶‡¶Ø‡¶º‡¶æ ‡¶ï‡¶∞‡ßá ‡¶ï‡¶®‡¶´‡¶ø‡¶ó‡¶æ‡¶∞‡ßá‡¶∂‡¶® ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®‡•§');
        }

        // ==================== GLOBAL VARIABLES ====================
        let currentEditingFormId = null;
        let currentViewingFormId = null;
        let questionIdCounter = 0;

        // ==================== UTILITY FUNCTIONS ====================
        function showLoading() {
            document.getElementById('loadingOverlay').classList.add('active');
        }

        function hideLoading() {
            document.getElementById('loadingOverlay').classList.remove('active');
        }

        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            document.getElementById(pageId).classList.add('active');
        }

        // ==================== AUTHENTICATION ====================
        async function signInAnonymously() {
            try {
                await auth.signInAnonymously();
                currentUser = auth.currentUser;
                return true;
            } catch (error) {
                console.error('Auth error:', error);
                return false;
            }
        }

        // ==================== PASSWORD MANAGEMENT ====================
        async function getAdminPassword() {
            try {
                const doc = await db.collection('admin').doc('password').get();
                if (doc.exists) {
                    return doc.data().password;
                }
                return 'admin123'; // Default
            } catch (error) {
                console.error('Error getting password:', error);
                return 'admin123';
            }
        }

        async function setAdminPassword(newPassword) {
            try {
                if (!currentUser) await signInAnonymously();
                await db.collection('admin').doc('password').set({
                    password: newPassword,
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                return true;
            } catch (error) {
                console.error('Error setting password:', error);
                return false;
            }
        }

        // ==================== INITIALIZATION ====================
        document.addEventListener('DOMContentLoaded', async () => {
            showLoading();
            
            // Check for public form link
            const urlParams = new URLSearchParams(window.location.search);
            const formId = urlParams.get('form');
            
            if (formId) {
                // Public form access
                await checkForPublicForm();
            } else {
                // Admin access
                checkIfLoggedIn();
            }
            
            updatePasswordHint();
            hideLoading();
        });

        function checkIfLoggedIn() {
            const isLoggedIn = sessionStorage.getItem('adminLoggedIn') === 'true';
            if (isLoggedIn) {
                showAdminDashboard();
            }
        }

        async function updatePasswordHint() {
            const hint = document.getElementById('defaultPasswordHint');
            if (hint) {
                const password = await getAdminPassword();
                if (password !== 'admin123') {
                    hint.style.display = 'none';
                }
            }
        }

        // ==================== LOGIN ====================
        async function attemptLogin() {
            showLoading();
            const password = document.getElementById('loginPassword').value;
            const adminPassword = await getAdminPassword();
            
            if (password === adminPassword) {
                sessionStorage.setItem('adminLoggedIn', 'true');
                await signInAnonymously();
                showAdminDashboard();
            } else {
                alert('‚ùå ‡¶≠‡ßÅ‡¶≤ ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°! ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§');
                document.getElementById('loginPassword').value = '';
            }
            hideLoading();
        }

        function logoutAdmin() {
            if (confirm('‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶≤‡¶ó ‡¶Ü‡¶â‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶ö‡¶æ‡¶®?')) {
                sessionStorage.removeItem('adminLoggedIn');
                auth.signOut();
                showPage('loginPage');
                document.getElementById('loginPassword').value = '';
            }
        }

        // ==================== PASSWORD CHANGE ====================
        function openChangePasswordModal() {
            document.getElementById('changePasswordModal').classList.add('active');
            document.getElementById('currentPassword').value = '';
            document.getElementById('newPassword').value = '';
            document.getElementById('confirmPassword').value = '';
            document.getElementById('passwordChangeError').style.display = 'none';
            document.getElementById('passwordChangeSuccess').style.display = 'none';
        }

        function closeChangePasswordModal() {
            document.getElementById('changePasswordModal').classList.remove('active');
        }

        async function changeAdminPassword() {
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            const errorDiv = document.getElementById('passwordChangeError');
            const successDiv = document.getElementById('passwordChangeSuccess');
            
            errorDiv.style.display = 'none';
            successDiv.style.display = 'none';

            if (!currentPassword || !newPassword || !confirmPassword) {
                errorDiv.textContent = '‚ùå ‡¶∏‡¶ï‡¶≤ ‡¶´‡¶ø‡¶≤‡ßç‡¶° ‡¶™‡ßÇ‡¶∞‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®!';
                errorDiv.style.display = 'block';
                return;
            }

            showLoading();
            const adminPassword = await getAdminPassword();

            if (currentPassword !== adminPassword) {
                errorDiv.textContent = '‚ùå ‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶≠‡ßÅ‡¶≤!';
                errorDiv.style.display = 'block';
                hideLoading();
                return;
            }

            if (newPassword.length < 6) {
                errorDiv.textContent = '‚ùå ‡¶®‡¶§‡ßÅ‡¶® ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶ï‡¶Æ‡¶™‡¶ï‡ßç‡¶∑‡ßá ‡ß¨ ‡¶Ö‡¶ï‡ßç‡¶∑‡¶∞‡ßá‡¶∞ ‡¶π‡¶§‡ßá ‡¶π‡¶¨‡ßá!';
                errorDiv.style.display = 'block';
                hideLoading();
                return;
            }

            if (newPassword !== confirmPassword) {
                errorDiv.textContent = '‚ùå ‡¶®‡¶§‡ßÅ‡¶® ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶è‡¶¨‡¶Ç ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§‡¶ï‡¶∞‡¶£ ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶Æ‡¶ø‡¶≤‡¶õ‡ßá ‡¶®‡¶æ!';
                errorDiv.style.display = 'block';
                hideLoading();
                return;
            }

            if (newPassword === currentPassword) {
                errorDiv.textContent = '‚ùå ‡¶®‡¶§‡ßÅ‡¶® ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°‡ßá‡¶∞ ‡¶•‡ßá‡¶ï‡ßá ‡¶Ü‡¶≤‡¶æ‡¶¶‡¶æ ‡¶π‡¶§‡ßá ‡¶π‡¶¨‡ßá!';
                errorDiv.style.display = 'block';
                hideLoading();
                return;
            }

            const success = await setAdminPassword(newPassword);
            hideLoading();

            if (success) {
                successDiv.textContent = '‚úÖ ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!';
                successDiv.style.display = 'block';
                document.getElementById('currentPassword').value = '';
                document.getElementById('newPassword').value = '';
                document.getElementById('confirmPassword').value = '';
                setTimeout(() => {
                    closeChangePasswordModal();
                }, 2000);
            } else {
                errorDiv.textContent = '‚ùå ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶®‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!';
                errorDiv.style.display = 'block';
            }
        }

        // ==================== PUBLIC FORM ACCESS ====================
        async function checkForPublicForm() {
            const urlParams = new URLSearchParams(window.location.search);
            const formId = urlParams.get('form');
            
            if (formId) {
                showLoading();
                const form = await getFormById(formId);
                hideLoading();

                if (form) {
                    document.getElementById('loginPage').classList.remove('active');
                    document.getElementById('adminPage').classList.remove('active');
                    document.getElementById('builderPage').classList.remove('active');
                    document.getElementById('responsesPage').classList.remove('active');
                    
                    const appHeaders = document.querySelectorAll('.app-header');
                    appHeaders.forEach(header => header.style.display = 'none');
                    
                    renderPublicFormFill(formId, form);
                } else {
                    document.getElementById('loginPage').classList.remove('active');
                    document.getElementById('fillPage').classList.add('active');
                    document.getElementById('fillFormContainer').innerHTML = `
                        <div style="text-align: center; padding: 60px 20px;">
                            <div style="font-size: 64px; margin-bottom: 20px;">‚ùå</div>
                            <h2 style="color: #2d3748; margin-bottom: 10px;">‡¶´‡¶∞‡ßç‡¶Æ ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø</h2>
                            <p style="color: #718096;">‡¶è‡¶á ‡¶´‡¶∞‡ßç‡¶Æ‡¶ü‡¶ø ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá ‡¶¨‡¶æ ‡¶≤‡¶ø‡¶Ç‡¶ï‡¶ü‡¶ø ‡¶≠‡ßÅ‡¶≤‡•§</p>
                        </div>
                    `;
                }
            }
        }

        // ==================== ADMIN DASHBOARD ====================
        async function showAdminDashboard() {
            showPage('adminPage');
            await loadAdminStats();
            await loadFormsList();
        }

        function backToAdmin() {
            currentEditingFormId = null;
            showAdminDashboard();
        }

        async function loadAdminStats() {
            showLoading();
            try {
                const formsSnapshot = await db.collection('forms').get();
                const responsesSnapshot = await db.collection('responses').get();
                
                document.getElementById('statTotalForms').textContent = formsSnapshot.size;
                document.getElementById('statTotalResponses').textContent = responsesSnapshot.size;
                
                const today = new Date().toDateString();
                let todayCount = 0;
                responsesSnapshot.forEach(doc => {
                    const data = doc.data();
                    if (data.timestamp && new Date(data.timestamp.toDate()).toDateString() === today) {
                        todayCount++;
                    }
                });
                document.getElementById('statTodayResponses').textContent = todayCount;
            } catch (error) {
                console.error('Error loading stats:', error);
            }
            hideLoading();
        }

        async function loadFormsList() {
            const container = document.getElementById('formsListContainer');
            
            showLoading();
            try {
                const snapshot = await db.collection('forms').orderBy('createdAt', 'desc').get();
                
                if (snapshot.empty) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-state-icon">üìù</div>
                            <h3>‡¶è‡¶ñ‡¶®‡¶ì ‡¶ï‡ßã‡¶® ‡¶´‡¶∞‡ßç‡¶Æ ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡¶®‡¶ø</h3>
                            <p>‡¶®‡¶§‡ßÅ‡¶® ‡¶´‡¶∞‡ßç‡¶Æ ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡¶§‡ßá ‡¶â‡¶™‡¶∞‡ßá‡¶∞ ‡¶¨‡¶æ‡¶ü‡¶®‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®</p>
                        </div>
                    `;
                    hideLoading();
                    return;
                }

                container.innerHTML = '<div class="forms-grid"></div>';
                const grid = container.querySelector('.forms-grid');

                for (const doc of snapshot.docs) {
                    const form = { id: doc.id, ...doc.data() };
                    const responsesCount = await getFormResponsesCount(form.id);
                    
                    const formItem = document.createElement('div');
                    formItem.className = 'form-item';
                    formItem.innerHTML = `
                        <div class="form-item-header">
                            <h3>${form.title}</h3>
                            <p>${form.description || '‡¶ï‡ßã‡¶® ‡¶¨‡¶ø‡¶¨‡¶∞‡¶£ ‡¶®‡ßá‡¶á'}</p>
                        </div>
                        <div class="form-item-meta">
                            üìä ${responsesCount} ‡¶ü‡¶ø ‡¶∞‡ßá‡¶∏‡¶™‡¶®‡ßç‡¶∏ | 
                            üìÖ ‡¶§‡ßà‡¶∞‡¶ø: ${form.createdAt ? new Date(form.createdAt.toDate()).toLocaleDateString('bn-BD') : 'N/A'}
                        </div>
                        <div class="form-item-actions">
                            <button class="btn btn-warning btn-sm" onclick="openShareModal('${form.id}')">üì§ ‡¶∂‡ßá‡¶Ø‡¶º‡¶æ‡¶∞</button>
                            <button class="btn btn-info btn-sm" onclick="previewForm('${form.id}')">üëÅÔ∏è ‡¶™‡ßç‡¶∞‡¶ø‡¶≠‡¶ø‡¶â</button>
                            <button class="btn btn-primary btn-sm" onclick="viewFormResponses('${form.id}')">üìä ‡¶∞‡ßá‡¶∏‡¶™‡¶®‡ßç‡¶∏ (${responsesCount})</button>
                            <button class="btn btn-secondary btn-sm" onclick="editForm('${form.id}')">‚úèÔ∏è ‡¶è‡¶°‡¶ø‡¶ü</button>
                            <button class="btn btn-secondary btn-sm" onclick="duplicateForm('${form.id}')">üìã ‡¶ï‡¶™‡¶ø</button>
                            <button class="btn btn-danger btn-sm" onclick="deleteForm('${form.id}')">üóëÔ∏è ‡¶Æ‡ßÅ‡¶õ‡ßÅ‡¶®</button>
                        </div>
                    `;
                    grid.appendChild(formItem);
                }
            } catch (error) {
                console.error('Error loading forms:', error);
                container.innerHTML = '<p style="color: #f56565;">‡¶´‡¶∞‡ßç‡¶Æ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!</p>';
            }
            hideLoading();
        }

        // ==================== FIRESTORE OPERATIONS ====================
        async function getFormById(formId) {
            try {
                const doc = await db.collection('forms').doc(formId).get();
                if (doc.exists) {
                    return { id: doc.id, ...doc.data() };
                }
                return null;
            } catch (error) {
                console.error('Error getting form:', error);
                return null;
            }
        }

        async function getFormResponsesCount(formId) {
            try {
                const snapshot = await db.collection('responses').where('formId', '==', formId).get();
                return snapshot.size;
            } catch (error) {
                console.error('Error counting responses:', error);
                return 0;
            }
        }

        async function getFormResponses(formId) {
            try {
                const snapshot = await db.collection('responses')
                    .where('formId', '==', formId)
                    .orderBy('timestamp', 'desc')
                    .get();
                
                const responses = [];
                snapshot.forEach(doc => {
                    responses.push({ id: doc.id, ...doc.data() });
                });
                return responses;
            } catch (error) {
                console.error('Error getting responses:', error);
                return [];
            }
        }

        // ==================== SHARE MODAL ====================
        function openShareModal(formId) {
            const currentUrl = window.location.href.split('?')[0];
            const shareUrl = currentUrl + '?form=' + formId;
            document.getElementById('shareLinkInput').value = shareUrl;
            document.getElementById('shareModal').classList.add('active');
            document.getElementById('copySuccessMsg').style.display = 'none';
        }

        function closeShareModal() {
            document.getElementById('shareModal').classList.remove('active');
        }

        function copyShareLink() {
            const input = document.getElementById('shareLinkInput');
            input.select();
            input.setSelectionRange(0, 99999);
            
            if (navigator.clipboard) {
                navigator.clipboard.writeText(input.value).then(() => {
                    showCopySuccess();
                }).catch(() => {
                    document.execCommand('copy');
                    showCopySuccess();
                });
            } else {
                document.execCommand('copy');
                showCopySuccess();
            }
        }

        function showCopySuccess() {
            const msg = document.getElementById('copySuccessMsg');
            msg.style.display = 'block';
            setTimeout(() => {
                msg.style.display = 'none';
            }, 3000);
        }

        // ==================== FORM BUILDER ====================
        function createNewForm() {
            currentEditingFormId = null;
            questionIdCounter = 0;
            
            document.getElementById('builderFormTitle').value = '';
            document.getElementById('builderFormDesc').value = '';
            document.getElementById('builderHeaderImage').value = '';
            document.getElementById('headerImagePreview').innerHTML = '';
            document.getElementById('questionsList').innerHTML = '';
            
            addNewQuestion();
            showPage('builderPage');
        }

        async function editForm(formId) {
            showLoading();
            const form = await getFormById(formId);
            hideLoading();

            if (!form) return;

            currentEditingFormId = formId;
            questionIdCounter = 0;

            document.getElementById('builderFormTitle').value = form.title;
            document.getElementById('builderFormDesc').value = form.description || '';
            
            if (form.headerImage) {
                document.getElementById('headerImagePreview').innerHTML = `
                    <div class="image-preview-box">
                        <img src="${form.headerImage}">
                        <button class="btn btn-danger btn-sm" onclick="removeHeaderImage()">‡¶õ‡¶¨‡¶ø ‡¶Æ‡ßÅ‡¶õ‡ßÅ‡¶®</button>
                    </div>
                `;
            } else {
                document.getElementById('headerImagePreview').innerHTML = '';
            }

            document.getElementById('questionsList').innerHTML = '';
            if (form.questions) {
                form.questions.forEach(q => {
                    addNewQuestion(q);
                });
            } else {
                addNewQuestion();
            }

            showPage('builderPage');
        }

        async function duplicateForm(formId) {
            if (!confirm('‡¶è‡¶á ‡¶´‡¶∞‡ßç‡¶Æ‡ßá‡¶∞ ‡¶ï‡¶™‡¶ø ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡¶§‡ßá ‡¶ö‡¶æ‡¶®?')) return;

            showLoading();
            const form = await getFormById(formId);
            
            if (form) {
                delete form.id;
                form.title = form.title + ' (‡¶ï‡¶™‡¶ø)';
                form.createdAt = firebase.firestore.FieldValue.serverTimestamp();
                form.updatedAt = firebase.firestore.FieldValue.serverTimestamp();

                try {
                    if (!currentUser) await signInAnonymously();
                    await db.collection('forms').add(form);
                    await loadFormsList();
                    alert('‚úÖ ‡¶´‡¶∞‡ßç‡¶Æ ‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!');
                } catch (error) {
                    console.error('Error duplicating form:', error);
                    alert('‚ùå ‡¶´‡¶∞‡ßç‡¶Æ ‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!');
                }
            }
            hideLoading();
        }

        async function deleteForm(formId) {
            if (!confirm('‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶è‡¶á ‡¶´‡¶∞‡ßç‡¶Æ ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶§‡ßá ‡¶ö‡¶æ‡¶®? ‡¶è‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶∏‡¶¨ ‡¶∞‡ßá‡¶∏‡¶™‡¶®‡ßç‡¶∏‡¶ì ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶Ø‡¶æ‡¶¨‡ßá‡•§')) return;

            showLoading();
            try {
                if (!currentUser) await signInAnonymously();
                
                // Delete form
                await db.collection('forms').doc(formId).delete();
                
                // Delete all responses
                const responsesSnapshot = await db.collection('responses').where('formId', '==', formId).get();
                const deletePromises = [];
                responsesSnapshot.forEach(doc => {
                    deletePromises.push(doc.ref.delete());
                });
                await Promise.all(deletePromises);
                
                await loadAdminStats();
                await loadFormsList();
                alert('‚úÖ ‡¶´‡¶∞‡ßç‡¶Æ ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!');
            } catch (error) {
                console.error('Error deleting form:', error);
                alert('‚ùå ‡¶´‡¶∞‡ßç‡¶Æ ‡¶Æ‡ßÅ‡¶õ‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!');
            }
            hideLoading();
        }

        function previewForm(formId) {
            window.open(window.location.href.split('?')[0] + '?form=' + formId, '_blank');
        }

        // ==================== IMAGE UPLOAD ====================
        async function uploadImageToStorage(file, path) {
            try {
                const storageRef = storage.ref();
                const imageRef = storageRef.child(path);
                await imageRef.put(file);
                const downloadURL = await imageRef.getDownloadURL();
                return downloadURL;
            } catch (error) {
                console.error('Error uploading image:', error);
                return null;
            }
        }

        async function handleHeaderImageUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            if (file.size > 5 * 1024 * 1024) {
                alert('‡¶õ‡¶¨‡¶ø ‡ß´MB ‡¶è‡¶∞ ‡¶ö‡ßá‡¶Ø‡¶º‡ßá ‡¶õ‡ßã‡¶ü ‡¶π‡¶§‡ßá ‡¶π‡¶¨‡ßá!');
                return;
            }

            showLoading();
            if (!currentUser) await signInAnonymously();
            
            const timestamp = Date.now();
            const uploadPath = `headers/${timestamp}_${file.name}`;
            const imageUrl = await uploadImageToStorage(file, uploadPath);
            
            if (imageUrl) {
                document.getElementById('headerImagePreview').innerHTML = `
                    <div class="image-preview-box">
                        <img src="${imageUrl}">
                        <button class="btn btn-danger btn-sm" onclick="removeHeaderImage()">‡¶õ‡¶¨‡¶ø ‡¶Æ‡ßÅ‡¶õ‡ßÅ‡¶®</button>
                    </div>
                `;
            } else {
                alert('‡¶õ‡¶¨‡¶ø ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!');
            }
            hideLoading();
        }

        function removeHeaderImage() {
            document.getElementById('builderHeaderImage').value = '';
            document.getElementById('headerImagePreview').innerHTML = '';
        }

        async function handleQuestionImageUpload(event, qId) {
            const file = event.target.files[0];
            if (!file) return;

            if (file.size > 5 * 1024 * 1024) {
                alert('‡¶õ‡¶¨‡¶ø ‡ß´MB ‡¶è‡¶∞ ‡¶ö‡ßá‡¶Ø‡¶º‡ßá ‡¶õ‡ßã‡¶ü ‡¶π‡¶§‡ßá ‡¶π‡¶¨‡ßá!');
                return;
            }

            showLoading();
            if (!currentUser) await signInAnonymously();
            
            const timestamp = Date.now();
            const uploadPath = `questions/${timestamp}_${file.name}`;
            const imageUrl = await uploadImageToStorage(file, uploadPath);
            
            if (imageUrl) {
                document.getElementById(qId + '_imgPreview').innerHTML = `
                    <div class="image-preview-box">
                        <img src="${imageUrl}">
                        <input type="text" class="q-img-desc" placeholder="‡¶õ‡¶¨‡¶ø‡¶∞ ‡¶¨‡¶ø‡¶¨‡¶∞‡¶£ (‡¶ê‡¶ö‡ßç‡¶õ‡¶ø‡¶ï)" style="width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #cbd5e0; border-radius: 6px;">
                        <button class="btn btn-danger btn-sm" onclick="removeQuestionImage('${qId}')">‡¶õ‡¶¨‡¶ø ‡¶Æ‡ßÅ‡¶õ‡ßÅ‡¶®</button>
                    </div>
                `;
            } else {
                alert('‡¶õ‡¶¨‡¶ø ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!');
            }
            hideLoading();
        }

        function removeQuestionImage(qId) {
            document.getElementById(qId + '_img').value = '';
            document.getElementById(qId + '_imgPreview').innerHTML = '';
        }

        // ==================== QUESTION BUILDER ====================
        function addNewQuestion(questionData = null) {
            questionIdCounter++;
            const qId = 'question_' + questionIdCounter;
            
            const questionsList = document.getElementById('questionsList');
            const questionDiv = document.createElement('div');
            questionDiv.className = 'question-item';
            questionDiv.id = qId;
            
            const type = questionData?.type || 'short';
            const text = questionData?.text || '';
            const required = questionData?.required || false;
            const image = questionData?.image || null;
            const imageDesc = questionData?.imageDescription || '';
            const options = questionData?.options || [];

            questionDiv.innerHTML = `
                <div class="question-header">
                    <input type="text" class="q-text" placeholder="‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®" value="${text}">
                    <select class="q-type" onchange="updateQuestionType('${qId}')">
                        <option value="short" ${type === 'short' ? 'selected' : ''}>‡¶∏‡¶Ç‡¶ï‡ßç‡¶∑‡¶ø‡¶™‡ßç‡¶§ ‡¶â‡¶§‡ßç‡¶§‡¶∞</option>
                        <option value="long" ${type === 'long' ? 'selected' : ''}>‡¶¶‡ßÄ‡¶∞‡ßç‡¶ò ‡¶â‡¶§‡ßç‡¶§‡¶∞</option>
                        <option value="radio" ${type === 'radio' ? 'selected' : ''}>‡¶è‡¶ï‡¶ü‡¶ø ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶®</option>
                        <option value="checkbox" ${type === 'checkbox' ? 'selected' : ''}>‡¶è‡¶ï‡¶æ‡¶ß‡¶ø‡¶ï ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶®</option>
                        <option value="dropdown" ${type === 'dropdown' ? 'selected' : ''}>‡¶°‡ßç‡¶∞‡¶™‡¶°‡¶æ‡¶â‡¶®</option>
                    </select>
                </div>

                <div class="question-image-section">
                    <label for="${qId}_img" class="file-upload-label">üì∑ ‡¶õ‡¶¨‡¶ø ‡¶Ü‡¶™‡¶≤‡ßã‡¶° (‡¶ê‡¶ö‡ßç‡¶õ‡¶ø‡¶ï)</label>
                    <input type="file" id="${qId}_img" accept="image/*" onchange="handleQuestionImageUpload(event, '${qId}')">
                    <div id="${qId}_imgPreview">
                        ${image ? `
                            <div class="image-preview-box">
                                <img src="${image}">
                                <input type="text" class="q-img-desc" placeholder="‡¶õ‡¶¨‡¶ø‡¶∞ ‡¶¨‡¶ø‡¶¨‡¶∞‡¶£ (‡¶ê‡¶ö‡ßç‡¶õ‡¶ø‡¶ï)" value="${imageDesc}" style="width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #cbd5e0; border-radius: 6px;">
                                <button class="btn btn-danger btn-sm" onclick="removeQuestionImage('${qId}')">‡¶õ‡¶¨‡¶ø ‡¶Æ‡ßÅ‡¶õ‡ßÅ‡¶®</button>
                            </div>
                        ` : ''}
                    </div>
                </div>

                <div class="options-list" id="${qId}_options"></div>

                <div class="question-footer">
                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                        <input type="checkbox" class="q-required" ${required ? 'checked' : ''}>
                        <span>‡¶Ü‡¶¨‡¶∂‡ßç‡¶Ø‡¶ï ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶®</span>
                    </label>
                    <div style="display: flex; gap: 10px;">
                        <button class="btn btn-secondary btn-sm" onclick="duplicateQuestion('${qId}')">üìã ‡¶ï‡¶™‡¶ø</button>
                        <button class="btn btn-danger btn-sm" onclick="deleteQuestion('${qId}')">üóëÔ∏è ‡¶Æ‡ßÅ‡¶õ‡ßÅ‡¶®</button>
                    </div>
                </div>
            `;

            questionsList.appendChild(questionDiv);

            if (['radio', 'checkbox', 'dropdown'].includes(type)) {
                showOptionsForQuestion(qId, options);
            }
        }

        function updateQuestionType(qId) {
            const questionDiv = document.getElementById(qId);
            const type = questionDiv.querySelector('.q-type').value;
            const optionsContainer = questionDiv.querySelector('.options-list');

            if (['radio', 'checkbox', 'dropdown'].includes(type)) {
                showOptionsForQuestion(qId);
            } else {
                optionsContainer.innerHTML = '';
            }
        }

        function showOptionsForQuestion(qId, existingOptions = []) {
            const optionsContainer = document.getElementById(qId + '_options');
            optionsContainer.innerHTML = `
                <div id="${qId}_optionsList"></div>
                <button class="btn btn-secondary btn-sm" onclick="addOptionToQuestion('${qId}')">‚ûï ‡¶Ö‡¶™‡¶∂‡¶® ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</button>
            `;

            if (existingOptions.length > 0) {
                existingOptions.forEach(opt => {
                    addOptionToQuestion(qId, opt);
                });
            } else {
                addOptionToQuestion(qId);
            }
        }

        function addOptionToQuestion(qId, optionText = '') {
            const optionsList = document.getElementById(qId + '_optionsList');
            const optionId = qId + '_opt_' + Date.now();
            
            const optionDiv = document.createElement('div');
            optionDiv.className = 'option-row';
            optionDiv.id = optionId;
            optionDiv.innerHTML = `
                <span>‚ö™</span>
                <input type="text" class="opt-text" placeholder="‡¶Ö‡¶™‡¶∂‡¶® ‡¶ü‡ßá‡¶ï‡ßç‡¶∏‡¶ü" value="${optionText}">
                <button class="btn btn-danger btn-sm" onclick="removeOption('${optionId}')">‚úï</button>
            `;
            optionsList.appendChild(optionDiv);
        }

        function removeOption(optionId) {
            document.getElementById(optionId).remove();
        }

        function duplicateQuestion(qId) {
            const originalDiv = document.getElementById(qId);
            const questionData = extractQuestionData(originalDiv);
            addNewQuestion(questionData);
        }

        function deleteQuestion(qId) {
            const questionsList = document.getElementById('questionsList');
            if (questionsList.children.length <= 1) {
                alert('‡¶Ö‡¶®‡ßç‡¶§‡¶§ ‡¶è‡¶ï‡¶ü‡¶ø ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶•‡¶æ‡¶ï‡¶§‡ßá ‡¶π‡¶¨‡ßá!');
                return;
            }
            document.getElementById(qId).remove();
        }

        function extractQuestionData(questionDiv) {
            const type = questionDiv.querySelector('.q-type').value;
            const text = questionDiv.querySelector('.q-text').value;
            const required = questionDiv.querySelector('.q-required').checked;
            
            const imgPreview = questionDiv.querySelector('.image-preview-box img');
            const image = imgPreview ? imgPreview.src : null;
            
            const imgDescInput = questionDiv.querySelector('.q-img-desc');
            const imageDescription = imgDescInput ? imgDescInput.value : '';

            const options = [];
            if (['radio', 'checkbox', 'dropdown'].includes(type)) {
                questionDiv.querySelectorAll('.opt-text').forEach(opt => {
                    const val = opt.value.trim();
                    if (val) options.push(val);
                });
            }

            return { type, text, required, image, imageDescription, options };
        }

        async function saveCurrentForm() {
            const title = document.getElementById('builderFormTitle').value.trim();
            if (!title) {
                alert('‡¶´‡¶∞‡ßç‡¶Æ‡ßá‡¶∞ ‡¶∂‡¶ø‡¶∞‡ßã‡¶®‡¶æ‡¶Æ ‡¶¶‡¶ø‡¶®!');
                return;
            }

            const description = document.getElementById('builderFormDesc').value.trim();
            
            const headerImgPreview = document.querySelector('#headerImagePreview img');
            const headerImage = headerImgPreview ? headerImgPreview.src : null;

            const questions = [];
            document.querySelectorAll('.question-item').forEach(qDiv => {
                const qData = extractQuestionData(qDiv);
                if (qData.text.trim()) {
                    questions.push(qData);
                }
            });

            if (questions.length === 0) {
                alert('‡¶Ö‡¶®‡ßç‡¶§‡¶§ ‡¶è‡¶ï‡¶ü‡¶ø ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®!');
                return;
            }

            const formData = {
                title,
                description,
                headerImage,
                questions,
                updatedAt: firebase.firestore.FieldValue.serverTimestamp()
            };

            showLoading();
            try {
                if (!currentUser) await signInAnonymously();

                if (currentEditingFormId) {
                    await db.collection('forms').doc(currentEditingFormId).update(formData);
                } else {
                    formData.createdAt = firebase.firestore.FieldValue.serverTimestamp();
                    await db.collection('forms').add(formData);
                }

                alert('‚úÖ ‡¶´‡¶∞‡ßç‡¶Æ ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶ø‡¶§ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!');
                backToAdmin();
            } catch (error) {
                console.error('Error saving form:', error);
                alert('‚ùå ‡¶´‡¶∞‡ßç‡¶Æ ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!');
            }
            hideLoading();
        }

        // ==================== PUBLIC FORM FILL ====================
        function renderPublicFormFill(formId, form) {
            currentViewingFormId = formId;
            const container = document.getElementById('fillFormContainer');

            let html = '';

            html += `<div class="form-header-section">`;
            if (form.headerImage) {
                html += `<img src="${form.headerImage}">`;
            }
            html += `<h1>${form.title}</h1>`;
            if (form.description) {
                html += `<p>${form.description}</p>`;
            }
            html += `</div>`;

            if (form.questions) {
                form.questions.forEach((q, idx) => {
                    html += `<div class="fill-question-item">`;
                    html += `<div class="question-label">${q.text}`;
                    if (q.required) {
                        html += `<span class="required-mark">*</span>`;
                    }
                    html += `</div>`;

                    if (q.image) {
                        html += `<img src="${q.image}">`;
                        if (q.imageDescription) {
                            html += `<div class="image-desc">${q.imageDescription}</div>`;
                        }
                    }

                    if (q.type === 'short') {
                        html += `<input type="text" class="answer-input" data-idx="${idx}" ${q.required ? 'required' : ''}>`;
                    } else if (q.type === 'long') {
                        html += `<textarea class="answer-input" data-idx="${idx}" ${q.required ? 'required' : ''}></textarea>`;
                    } else if (q.type === 'radio') {
                        html += `<div class="radio-group">`;
                        q.options.forEach(opt => {
                            html += `
                                <label class="choice-option">
                                    <input type="radio" name="q${idx}" value="${opt}" class="answer-input" data-idx="${idx}" ${q.required ? 'required' : ''}>
                                    <span>${opt}</span>
                                </label>
                            `;
                        });
                        html += `</div>`;
                    } else if (q.type === 'checkbox') {
                        html += `<div class="checkbox-group">`;
                        q.options.forEach(opt => {
                            html += `
                                <label class="choice-option">
                                    <input type="checkbox" value="${opt}" class="answer-checkbox" data-idx="${idx}">
                                    <span>${opt}</span>
                                </label>
                            `;
                        });
                        html += `</div>`;
                    } else if (q.type === 'dropdown') {
                        html += `<select class="answer-input" data-idx="${idx}" ${q.required ? 'required' : ''} style="width: 100%; padding: 12px; border: 1px solid #cbd5e0; border-radius: 6px;">
                            <option value="">‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</option>`;
                        q.options.forEach(opt => {
                            html += `<option value="${opt}">${opt}</option>`;
                        });
                        html += `</select>`;
                    }

                    html += `</div>`;
                });
            }

            html += `<div style="margin-top: 20px; text-align: center;">`;
            html += `<button class="btn btn-success" style="padding: 15px 40px; font-size: 16px;" onclick="submitFormResponse()">‡¶ú‡¶Æ‡¶æ ‡¶¶‡¶ø‡¶®</button>`;
            html += `</div>`;

            container.innerHTML = html;
            document.getElementById('submitSuccess').classList.remove('show');
            showPage('fillPage');
        }

        async function submitFormResponse() {
            showLoading();
            const form = await getFormById(currentViewingFormId);
            hideLoading();

            if (!form) {
                alert('‡¶´‡¶∞‡ßç‡¶Æ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!');
                return;
            }

            const answers = [];

            for (let i = 0; i < form.questions.length; i++) {
                const q = form.questions[i];

                if (q.type === 'checkbox') {
                    const checked = Array.from(document.querySelectorAll(`.answer-checkbox[data-idx="${i}"]:checked`))
                        .map(cb => cb.value);
                    
                    if (q.required && checked.length === 0) {
                        alert(`"${q.text}" ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶®‡ßá‡¶∞ ‡¶â‡¶§‡ßç‡¶§‡¶∞ ‡¶Ü‡¶¨‡¶∂‡ßç‡¶Ø‡¶ï!`);
                        return;
                    }
                    answers.push(checked.join(', '));
                } else {
                    let value = '';
                    if (q.type === 'radio') {
                        const checked = document.querySelector(`input[name="q${i}"]:checked`);
                        value = checked ? checked.value : '';
                    } else {
                        const input = document.querySelector(`.answer-input[data-idx="${i}"]`);
                        value = input ? input.value.trim() : '';
                    }

                    if (q.required && !value) {
                        alert(`"${q.text}" ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶®‡ßá‡¶∞ ‡¶â‡¶§‡ßç‡¶§‡¶∞ ‡¶Ü‡¶¨‡¶∂‡ßç‡¶Ø‡¶ï!`);
                        return;
                    }
                    answers.push(value);
                }
            }

            const response = {
                formId: currentViewingFormId,
                answers,
                timestamp: firebase.firestore.FieldValue.serverTimestamp()
            };

            showLoading();
            try {
                await db.collection('responses').add(response);
                
                document.getElementById('submitSuccess').classList.add('show');
                document.getElementById('fillFormContainer').innerHTML = '';

                const urlParams = new URLSearchParams(window.location.search);
                const isPublicForm = urlParams.get('form');

                if (isPublicForm) {
                    setTimeout(() => {
                        document.getElementById('fillFormContainer').innerHTML = `
                            <div style="text-align: center; padding: 60px 20px;">
                                <div style="font-size: 64px; margin-bottom: 20px;">‚úÖ</div>
                                <h2 style="color: #2d3748; margin-bottom: 10px;">‡¶ß‡¶®‡ßç‡¶Ø‡¶¨‡¶æ‡¶¶!</h2>
                                <p style="color: #718096;">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶â‡¶§‡ßç‡¶§‡¶∞ ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶ú‡¶Æ‡¶æ ‡¶¶‡ßá‡¶ì‡¶Ø‡¶º‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá</p>
                                <button class="btn btn-primary" style="margin-top: 20px;" onclick="location.reload()">‡¶Ü‡¶∞‡ßá‡¶ï‡¶ü‡¶ø ‡¶∞‡ßá‡¶∏‡¶™‡¶®‡ßç‡¶∏ ‡¶ú‡¶Æ‡¶æ ‡¶¶‡¶ø‡¶®</button>
                            </div>
                        `;
                        document.getElementById('submitSuccess').classList.remove('show');
                    }, 2000);
                } else {
                    setTimeout(() => {
                        backToAdmin();
                    }, 2000);
                }
            } catch (error) {
                console.error('Error submitting response:', error);
                alert('‚ùå ‡¶∞‡ßá‡¶∏‡¶™‡¶®‡ßç‡¶∏ ‡¶ú‡¶Æ‡¶æ ‡¶¶‡¶ø‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!');
            }
            hideLoading();
        }

        // ==================== RESPONSES VIEW ====================
        async function viewFormResponses(formId) {
            showLoading();
            const form = await getFormById(formId);
            const responses = await getFormResponses(formId);

            currentViewingFormId = formId;
            document.getElementById('responsesPageTitle').textContent = `"${form.title}" ‡¶è‡¶∞ ‡¶∞‡ßá‡¶∏‡¶™‡¶®‡ßç‡¶∏ (${responses.length})`;

            const container = document.getElementById('responsesListContainer');

            if (responses.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üìä</div>
                        <h3>‡¶è‡¶ñ‡¶®‡¶ì ‡¶ï‡ßã‡¶® ‡¶∞‡ßá‡¶∏‡¶™‡¶®‡ßç‡¶∏ ‡¶Ü‡¶∏‡ßá‡¶®‡¶ø</h3>
                    </div>
                `;
            } else {
                container.innerHTML = '';
                responses.forEach((resp, idx) => {
                    const respDiv = document.createElement('div');
                    respDiv.className = 'response-item';

                    let html = `
                        <div class="response-header">
                            <strong style="color: #2d3748;">‡¶∞‡ßá‡¶∏‡¶™‡¶®‡ßç‡¶∏ #${idx + 1}</strong>
                            <span style="color: #718096;">${resp.timestamp ? new Date(resp.timestamp.toDate()).toLocaleString('bn-BD') : 'N/A'}</span>
                        </div>
                        <div class="response-content">
                    `;

                    form.questions.forEach((q, qIdx) => {
                        html += `
                            <div class="response-qa">
                                <div class="q">${q.text}</div>
                                <div class="a">${resp.answers[qIdx] || '‡¶â‡¶§‡ßç‡¶§‡¶∞ ‡¶¶‡ßá‡¶ì‡¶Ø‡¶º‡¶æ ‡¶π‡¶Ø‡¶º‡¶®‡¶ø'}</div>
                            </div>
                        `;
                    });

                    html += `</div>`;
                    html += `<div style="text-align: right; margin-top: 15px;">
                        <button class="btn btn-danger btn-sm" onclick="deleteResponse('${resp.id}', '${formId}')">üóëÔ∏è ‡¶Æ‡ßÅ‡¶õ‡ßÅ‡¶®</button>
                    </div>`;

                    respDiv.innerHTML = html;
                    container.appendChild(respDiv);
                });
            }

            hideLoading();
            showPage('responsesPage');
        }

        async function deleteResponse(respId, formId) {
            if (!confirm('‡¶è‡¶á ‡¶∞‡ßá‡¶∏‡¶™‡¶®‡ßç‡¶∏ ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶§‡ßá ‡¶ö‡¶æ‡¶®?')) return;

            showLoading();
            try {
                if (!currentUser) await signInAnonymously();
                await db.collection('responses').doc(respId).delete();
                await viewFormResponses(formId);
            } catch (error) {
                console.error('Error deleting response:', error);
                alert('‚ùå ‡¶∞‡ßá‡¶∏‡¶™‡¶®‡ßç‡¶∏ ‡¶Æ‡ßÅ‡¶õ‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!');
            }
            hideLoading();
        }

        async function exportCurrentResponses() {
            showLoading();
            const form = await getFormById(currentViewingFormId);
            const responses = await getFormResponses(currentViewingFormId);
            hideLoading();

            if (responses.length === 0) {
                alert('‡¶ï‡ßã‡¶® ‡¶∞‡ßá‡¶∏‡¶™‡¶®‡ßç‡¶∏ ‡¶®‡ßá‡¶á!');
                return;
            }

            let csv = '\uFEFF';
            csv += '‡¶∞‡ßá‡¶∏‡¶™‡¶®‡ßç‡¶∏ ‡¶®‡¶Ç,‡¶∏‡¶Æ‡¶Ø‡¶º,';
            csv += form.questions.map(q => `"${q.text}"`).join(',');
            csv += '\n';

            responses.forEach((resp, idx) => {
                csv += `${idx + 1},"${resp.timestamp ? new Date(resp.timestamp.toDate()).toLocaleString('bn-BD') : 'N/A'}",`;
                csv += resp.answers.map(a => `"${a || ''}"`).join(',');
                csv += '\n';
            });

            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `${form.title}_responses_${new Date().toISOString().split('T')[0]}.csv`;
            link.click();
        }
    </script>
</body>
</html>
